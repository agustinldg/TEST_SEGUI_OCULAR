<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galería de Animales</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Galería de Animales</h1>
        <div class="gallery">
            <div class="animal-card">
                <img src="https://images.unsplash.com/photo-1548247416-ec66f4900b2e?w=800&h=600&fit=crop" alt="León" class="animal-image">
                <div class="animal-info">
                    <h3>León</h3>
                    <p>El rey de la selva</p>
                </div>
            </div>
            
            <div class="animal-card">
                <img src="https://images.unsplash.com/photo-1517849845537-4d257902454a?w=800&h=600&fit=crop" alt="Elefante" class="animal-image">
                <div class="animal-info">
                    <h3>Elefante</h3>
                    <p>El gigante gentil</p>
                </div>
            </div>
            
            <div class="animal-card">
                <img src="https://images.unsplash.com/photo-1552410260-0fd9b577afa6?w=800&h=600&fit=crop" alt="Tigre" class="animal-image">
                <div class="animal-info">
                    <h3>Tigre</h3>
                    <p>El cazador sigiloso</p>
                </div>
            </div>
            
            <div class="animal-card">
                <img src="https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=800&h=600&fit=crop" alt="Águila" class="animal-image">
                <div class="animal-info">
                    <h3>Águila</h3>
                    <p>El señor del cielo</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Script cargado, inicializando coronas circulares...');
            const animalCards = document.querySelectorAll('.animal-card');
            console.log('Tarjetas encontradas:', animalCards.length);
            
            // Estado independiente para cada imagen
            const imageStates = {};
            
            // Colores para el marco cuando se completa
            const frameColors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'];
            let currentColorIndex = 0;
            
            animalCards.forEach((card, index) => {
                console.log(`Configurando corona para imagen ${index + 1}`);
                
                // Inicializar estado para esta imagen
                imageStates[index] = {
                    isAnimating: false,
                    currentProgress: 0,
                    startTime: null,
                    pauseTime: null,
                    hideTimeout: null,
                    animationFrame: null,
                    completionCount: 0 // Contador de veces completada
                };
                
                // Crear elemento corona - radio = 1/4 del ancho de la imagen
                const corona = document.createElement('div');
                corona.id = `corona-${index}`;
                corona.style.position = 'absolute';
                corona.style.top = '50%';
                corona.style.left = '50%';
                corona.style.width = '50%'; // Radio = 1/4 del ancho, diámetro = 1/2 del ancho
                corona.style.height = '50%'; // Mantener forma circular
                corona.style.transform = 'translate(-50%, -50%)';
                corona.style.borderRadius = '50%';
                corona.style.border = '8px solid transparent';
                corona.style.pointerEvents = 'none';
                corona.style.zIndex = '999';
                corona.style.transition = 'border-color 0.3s ease';
                
                // Crear marco de completación EXACTAMENTE EN EL BORDE
                const frame = document.createElement('div');
                frame.id = `frame-${index}`;
                frame.style.position = 'absolute';
                frame.style.top = '0px';
                frame.style.left = '0px';
                frame.style.width = '100%';
                frame.style.height = '100%';
                frame.style.borderRadius = '15px';
                frame.style.border = '6px solid #ff6b6b'; // Color inicial visible, más grueso
                frame.style.pointerEvents = 'none';
                frame.style.zIndex = '1000'; // Mayor z-index
                frame.style.opacity = '0';
                frame.style.transition = 'opacity 0.3s ease';
                frame.style.boxShadow = '0 0 0 2px rgba(255, 255, 255, 0.8)'; // Sombra blanca para contraste
                
                // Hacer la tarjeta relativa para posicionar elementos absolutos
                card.style.position = 'relative';
                card.appendChild(corona);
                card.appendChild(frame);
                
                function startCoronaAnimation() {
                    const state = imageStates[index];
                    
                    // Cancelar timeout pendiente
                    if (state.hideTimeout) {
                        clearTimeout(state.hideTimeout);
                        state.hideTimeout = null;
                    }
                    
                    // Si ya está animando, no hacer nada
                    if (state.isAnimating) {
                        return;
                    }
                    
                    console.log(`Iniciando corona para imagen ${index + 1} - progreso: ${state.currentProgress}`);
                    
                    // Calcular tiempo inicial basado en progreso actual
                    state.startTime = Date.now() - (state.currentProgress * 3000); // 3 segundos
                    state.isAnimating = true;
                    
                    // Mostrar corona
                    corona.style.opacity = '1';
                    
                    animateCorona();
                }
                
                function animateCorona() {
                    const state = imageStates[index];
                    
                    if (!state.isAnimating) {
                        return;
                    }
                    
                    const elapsed = Date.now() - state.startTime;
                    const progress = Math.min(elapsed / 3000, 1); // 3 segundos
                    state.currentProgress = progress;
                    
                    // Crear conic-gradient para simular corona circular
                    const angle = progress * 360;
                    const coronaColor = `conic-gradient(from 0deg, #ffffff 0deg, #ffffff ${angle}deg, transparent ${angle}deg)`;
                    
                    // Aplicar máscara circular para que solo se vea el borde
                    corona.style.background = coronaColor;
                    corona.style.webkitMaskImage = 'radial-gradient(circle, transparent 45%, black 45%, black 55%, transparent 55%)';
                    corona.style.maskImage = 'radial-gradient(circle, transparent 45%, black 45%, black 55%, transparent 55%)';
                    
                    // Verificar si se completó
                    if (progress >= 1) {
                        state.isAnimating = false;
                        state.currentProgress = 0; // Reset para próxima vez
                        console.log(`Corona completada para imagen ${index + 1} - progreso: ${progress}`);
                        
                        // Disparar evento de completación
                        triggerCompletionEvent(index);
                    } else if (state.isAnimating) {
                        state.animationFrame = requestAnimationFrame(animateCorona);
                    }
                }
                
                function triggerCompletionEvent(imageIndex) {
                    const state = imageStates[imageIndex];
                    state.completionCount++;
                    
                    console.log(`Evento de completación para imagen ${imageIndex + 1} (vez #${state.completionCount})`);
                    
                    // Mostrar marco
                    const frame = document.getElementById(`frame-${imageIndex}`);
                    frame.style.opacity = '1';
                    
                    // Cambiar color del marco
                    const colorIndex = (state.completionCount - 1) % frameColors.length;
                    frame.style.border = `6px solid ${frameColors[colorIndex]}`;
                    
                    console.log(`Marco mostrado con color: ${frameColors[colorIndex]}`);
                }
                
                function pauseCoronaAnimation() {
                    const state = imageStates[index];
                    console.log(`Pausando corona para imagen ${index + 1}`);
                    
                    state.isAnimating = false;
                    if (state.animationFrame) {
                        cancelAnimationFrame(state.animationFrame);
                        state.animationFrame = null;
                    }
                    
                    // Timeout para ocultar corona después de 2 segundos
                    state.hideTimeout = setTimeout(() => {
                        console.log(`Ocultando corona para imagen ${index + 1} después del timeout`);
                        
                        const corona = document.getElementById(`corona-${index}`);
                        corona.style.opacity = '0';
                        
                        state.hideTimeout = null;
                        // Mantener el progreso para reanudación
                    }, 2000);
                }
                
                // Event listeners
                card.addEventListener('mouseenter', function() {
                    console.log(`Mouse enter en imagen ${index + 1}`);
                    startCoronaAnimation();
                });
                
                card.addEventListener('mouseleave', function() {
                    console.log(`Mouse leave en imagen ${index + 1}`);
                    pauseCoronaAnimation();
                });
            });
            
            console.log('Sistema de coronas inicializado correctamente');
        });
    </script>
</body>
</html>
